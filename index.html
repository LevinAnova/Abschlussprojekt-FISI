<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Volkswagen Ausbildungsberufe</title>
  <link rel="stylesheet" href="style/styles.css">
  <link rel="manifest" href="manifest.json">
</head>

<body>
  <div class="animated-background"></div>
  <button class="back-to-landing" onclick="window.location.href='landing.html'">
    <span>Zurück zur Startseite</span>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
      <path
        d="M10.4 12l5.3-5.3c0.4-0.4 0.4-1 0-1.4s-1-0.4-1.4 0l-6 6c-0.4 0.4-0.4 1 0 1.4l6 6c0.2 0.2 0.5 0.3 0.7 0.3s0.5-0.1 0.7-0.3c0.4-0.4 0.4-1 0-1.4L10.4 12z" />
    </svg>
  </button>
  <div class="language-selector">
    <label for="language-select">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="2" y1="12" x2="22" y2="12"></line>
        <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
      </svg>
      Sprache
    </label>
    <select id="language-select" onchange="changeLanguage(this.value)">
      <option value="de">Deutsch</option>
      <option value="en">English</option>
      <option value="fr">Français</option>
      <option value="es">Español</option>
      <option value="it">Italiano</option>
      <option value="ar">العربية</option>
      <option value="ru">Русский</option>
      <option value="pl">Polski</option>
      <option value="cz">Čeština</option>
      <option value="hu">Magyar</option>
      <option value="ro">Română</option>
      <option value="bg">Български</option>
    </select>
  </div>
  <div class="container">
    <header>
      <img src="img/vwlogo.png" class="logo">
      <h1 class="title">Ausbildungsberufe</h1>
      <div style="width: 60px;"></div>
    </header>

    <div class="filter-container" id="filterContainer">
      <button class="filter-btn active" data-category="all">Alle</button>
    </div>

    <div class="card-container" id="cardContainer">
      <div id="loadingIndicator" class="loading-indicator">
        <div class="spinner"></div>
        <p>Daten werden geladen...</p>
      </div>
    </div>

    <footer>
      <p>© Volkswagen AG 2025 | Ausbildungsberufe</p>
    </footer>
  </div>

  <!-- Inaktivitätswarnung -->
  <div id="inactivityWarning" class="inactivity-warning">
    <div class="warning-content">
      <div class="warning-icon">⚠️</div>
      <p>Aufgrund von Inaktivität werden Sie zur Startseite weitergeleitet.</p>
      <div class="countdown" id="countdown">30</div>
      <button id="stayButton" onclick="resetInactivityTimer()">Auf dieser Seite bleiben</button>
    </div>
  </div>

  <!-- Detail Seite HTML-Struktur -->
  <div id="detailPage" class="detail-page">
    <!-- Header und Navigation bleiben bestehen -->
    <div class="detail-header">
      <button id="backButton" class="back-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
      </button>
      <h2 id="detailTitle" class="detail-title">Ausbildungsberuf</h2>
      <div style="width: 40px;"></div>
    </div>

    <span id="detailCategory" class="detail-category">Kategorie</span>

    <!-- Neues flexibles Container-Layout -->
    <div class="detail-container">
      <!-- Oberer Bereich: QR-Code und Galerie nebeneinander -->
      <div class="flex-container top-section">
        <!-- QR-Code Container -->
        <div class="qr-code-container">
          <h3 class="qr-title">Direkt bewerben</h3>
          <p class="qr-text">Scanne den QR-Code, um dich für diesen Ausbildungsberuf zu bewerben.</p>
          <div class="qr-code">
            <img src="/api/placeholder/250/250" alt="QR-Code" id="qrCodeImage">
            <div class="qr-beruf-id" id="qrBerufId"></div>
          </div>
        </div>

        <!-- Bildergalerie Container -->
        <div class="image-gallery-container">
          <h3 class="gallery-title">Einblicke in den Beruf</h3>
          <div class="image-gallery">
            <div class="gallery-wrapper">
              <!-- Bilder werden dynamisch eingefügt -->
            </div>
          </div>
          <div class="gallery-navigation">
            <button class="gallery-button prev-button">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" fill="currentColor" />
              </svg>
            </button>
            <div class="gallery-dots">
              <!-- Dots werden dynamisch eingefügt -->
            </div>
            <button class="gallery-button next-button">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                <path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z" fill="currentColor" />
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Mittlerer Bereich: Wissenstest-Button -->
      <div class="knowledge-test-container" id="knowledgeTestContainer">
        <a id="testKnowledgeLink" href="#" class="knowledge-test-button">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          Teste dein Wissen
        </a>
        <p class="knowledge-test-info">Finde heraus, ob dieser Beruf zu dir passt!</p>
      </div>

      <!-- Unterer Bereich: Berufsinfos -->
      <div class="detail-main">
        <div class="detail-section">
          <h3>Beschreibung</h3>
          <div id="detailDescription"></div>
        </div>

        <div class="detail-section">
          <h3>Ausbildungsdauer</h3>
          <div id="detailDuration"></div>
        </div>

        <div class="detail-section">
          <h3>Anforderungen</h3>
          <div id="detailRequirements"></div>
        </div>

        <div class="detail-section">
          <h3>Karrieremöglichkeiten</h3>
          <div id="detailCareer"></div>
        </div>

        <div class="detail-section">
          <h3>Standorte</h3>
          <div id="detailLocations"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Fullscreen-Overlay für Bildvergrößerung -->
  <div class="fullscreen-overlay">
    <img src="" alt="" class="fullscreen-image">
    <div class="close-fullscreen">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </div>
  </div>

  <script>
    // CMS-Konfiguration für die Direktus-API
    const cmsConfig = {
      apiUrl: 'http://localhost/api', // Direktus API über Nginx Proxy
      imageBasePath: 'http://localhost/assets', // Pfad zu Bildern/Assets
      refreshInterval: 3600000, // 1 Stunde Aktualisierungsintervall
      cacheName: 'vw-ausbildung-cache', // Cache-Name für Offline-Funktionalität
      useMockData: false, // CMS-Daten verwenden
      offlineEnabled: true // Offline-Funktionalität aktivieren
    };

    // Cache für die geladenen Daten
    let contentCache = {
      categories: [],
      berufe: []
    };

    async function fetchCmsData() {
      const loadingIndicator = document.getElementById('loadingIndicator');
      loadingIndicator.style.display = 'flex';

      try {
        // Daten vom Backend abrufen
        const categoriesResponse = await fetch('http://localhost:4848/api/categories');
        const professionsResponse = await fetch('http://localhost:4848/api/professions');

        if (!categoriesResponse.ok || !professionsResponse.ok) {
          throw new Error('Fehler beim Laden der Daten');
        }

        const categories = await categoriesResponse.json();
        const professions = await professionsResponse.json();

        // Daten transformieren
        const transformedData = {
          categories: [
            { id: "all", name: "Alle" }, // Standard-Kategorie hinzufügen
            ...categories.map(category => ({
              id: category.id,
              name: category.name
            }))
          ],
          berufe: professions.map(profession => ({
            id: profession.id,
            title: profession.title,
            description: profession.description,
            duration: profession.duration,
            category: profession.category_id,
            requirements: profession.requirements,
            career_options: profession.career_options,
            locations: profession.locations,
            hasKnowledgeTest: profession.has_knowledge_test,
            gallery_images: profession.gallery_images,
            qr_code: profession.qr_code
          }))
        };

        // Daten für Offline-Nutzung speichern
        if (cmsConfig.offlineEnabled) {
          localStorage.setItem('cms_data', JSON.stringify(transformedData));
          localStorage.setItem('cms_last_update', new Date().toISOString());
        }

        return transformedData;
      } catch (error) {
        console.error('Fehler beim Laden der Daten:', error);

        // Bei Netzwerkfehlern die gespeicherten Daten aus dem LocalStorage laden
        if (cmsConfig.offlineEnabled && localStorage.getItem('cms_data')) {
          console.log('Offline-Modus: Lade gespeicherte Daten');
          return JSON.parse(localStorage.getItem('cms_data'));
        }

        // Fehleranzeige
        const cardContainer = document.getElementById('cardContainer');
        cardContainer.innerHTML = `
      <div class="error-message">
        <p>Fehler beim Laden der Daten. Bitte versuchen Sie es später erneut.</p>
        <button id="retryButton">Erneut versuchen</button>
      </div>
    `;
        document.getElementById('retryButton').addEventListener('click', initializeApp);
        return null;
      } finally {
        loadingIndicator.style.display = 'none';
      }
    }

    // Kategorien aus dem Direktus-Format transformieren
    function transformCategories(categoriesData) {
      const categories = [
        { id: "all", name: "Alle" } // Standard-Kategorie "Alle" beibehalten
      ];

      categoriesData.forEach(category => {
        categories.push({
          id: category.slug,
          name: category.name
        });
      });

      return categories;
    }

    // Berufe aus dem Direktus-Format transformieren
    function transformProfessions(professionsData) {
      return professionsData.map(profession => {
        // Anforderungen aus JSON extrahieren
        const requirements = Array.isArray(profession.requirements)
          ? profession.requirements.map(item => item.text || item)
          : [];

        // Karriereoptionen aus JSON extrahieren
        const careerOptions = Array.isArray(profession.career_options)
          ? profession.career_options.map(item => item.text || item)
          : [];

        // Standorte aus JSON extrahieren
        const locations = Array.isArray(profession.locations)
          ? profession.locations.map(item => item.text || item)
          : [];

        // Bilder für die Galerie
        const galleryImages = profession.gallery_images?.map(img => ({
          src: `${cmsConfig.imageBasePath}/${img.id}`,
          alt: img.title || profession.title
        })) || [];

        return {
          id: profession.slug,
          title: profession.title,
          description: profession.description,
          duration: profession.duration,
          category: profession.category?.slug || "all",
          requirements: requirements,
          career_options: careerOptions,
          locations: locations,
          hasKnowledgeTest: profession.has_knowledge_test || false,
          knowledgeTestUrl: profession.knowledge_test_url || null,
          gallery_images: galleryImages
        };
      });
    }

    // Filter initialisieren
    function initializeFilters(categories) {
      const filterContainer = document.getElementById('filterContainer');
      filterContainer.innerHTML = '';

      categories.forEach(category => {
        const button = document.createElement('button');
        button.className = 'filter-btn' + (category.id === 'all' ? ' active' : '');
        button.setAttribute('data-category', category.id);
        button.textContent = category.name;

        button.addEventListener('click', function () {
          // Benutzerinteraktion - Timer zurücksetzen
          resetInactivityTimer();

          this.classList.add('touch-active');
          setTimeout(() => {
            this.classList.remove('touch-active');
          }, 200);

          document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
          });

          this.classList.add('active');

          filterCards(this.dataset.category);
        });

        filterContainer.appendChild(button);
      });
    }

    // Karten erstellen
    function createCards(berufe) {
      const container = document.getElementById('cardContainer');
      container.innerHTML = '';

      berufe.forEach((beruf, index) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.id = beruf.id;
        card.dataset.category = beruf.category;
        card.style.animationDelay = `${0.1 + (index * 0.05)}s`;

        card.addEventListener('click', function () {
          // Benutzerinteraktion - Timer zurücksetzen
          resetInactivityTimer();
          openDetailPage(beruf.id);
        });

        card.innerHTML = `
          <div class="card-header">
            <h2 class="card-title">${beruf.title}</h2>
            <div class="card-category">${getCategoryName(beruf.category)}</div>
          </div>
          <div class="card-body">
            <p class="card-description">${beruf.description}</p>
            <div class="card-duration">Ausbildungsdauer: ${beruf.duration}</div>
          </div>
        `;

        container.appendChild(card);
      });
    }

    // Kategoriename aus der ID ermitteln
    function getCategoryName(categoryId) {
      const category = contentCache.categories.find(cat => cat.id === categoryId);
      return category ? category.name : categoryId;
    }

    // Beruf anhand der ID finden
    function findBerufById(id) {
      return contentCache.berufe.find(beruf => beruf.id === id);
    }

    // Karten nach Kategorie filtern
    function filterCards(categoryId) {
      const cards = document.querySelectorAll('.card');

      cards.forEach((card, index) => {
        const display = categoryId === 'all' || card.dataset.category === categoryId;

        card.style.animation = 'none';

        if (display) {
          card.style.display = 'flex';

          setTimeout(() => {
            card.style.animation = `rotateIn 0.7s cubic-bezier(0.23, 1, 0.32, 1) forwards ${index * 0.05}s`;
          }, 10);
        } else {
          card.style.display = 'none';
        }
      });
    }

    // Detailseite öffnen
    function openDetailPage(berufId) {
      const detailPage = document.getElementById('detailPage');
      const beruf = findBerufById(berufId);

      if (!beruf) {
        console.error(`Beruf with ID ${berufId} not found`);
        return;
      }

      // Set title and category
      const detailTitle = document.getElementById('detailTitle');
      const detailCategory = document.getElementById('detailCategory');
      detailTitle.textContent = beruf.title;
      detailTitle.dataset.berufId = berufId;

      detailCategory.textContent = getCategoryName(beruf.category);

      // Set detail sections
      document.getElementById('detailDescription').innerHTML = `<p>${beruf.description}</p>`;
      document.getElementById('detailDuration').innerHTML = `<p>${beruf.duration}</p>`;

      if (beruf.requirements && beruf.requirements.length > 0) {
        document.getElementById('detailRequirements').innerHTML = `<ul>${beruf.requirements.map(req => `<li>${req}</li>`).join('')}</ul>`;
      } else {
        document.getElementById('detailRequirements').innerHTML = '<p>Keine Angaben</p>';
      }

      if (beruf.career_options && beruf.career_options.length > 0) {
        document.getElementById('detailCareer').innerHTML = `<ul>${beruf.career_options.map(career => `<li>${career}</li>`).join('')}</ul>`;
      } else {
        document.getElementById('detailCareer').innerHTML = '<p>Keine Angaben</p>';
      }

      if (beruf.locations && beruf.locations.length > 0) {
        document.getElementById('detailLocations').innerHTML = `<ul>${beruf.locations.map(location => `<li>${location}</li>`).join('')}</ul>`;
      } else {
        document.getElementById('detailLocations').innerHTML = '<p>Keine Angaben</p>';
      }

      // QR-Code ID aktualisieren
      const qrBerufId = document.getElementById('qrBerufId');
      if (beruf.qr_code) {
        const qrCodeImg = document.getElementById('qrCodeImage');
        if (qrCodeImg) {
          qrCodeImg.src = beruf.qr_code;
          qrCodeImg.onerror = function () {
            console.warn('QR-Code konnte nicht geladen werden:', beruf.qr_code);
            this.src = '/api/placeholder/250/250';
            this.onerror = null;
          };
        }
      }
      // Bilder für die Galerie laden
      loadGalleryImages(berufId);

      // Wissenstest-Link konfigurieren
      const hasKnowledgeTest = checkIfKnowledgeTestExists(berufId);
      const knowledgeTestLink = document.getElementById('testKnowledgeLink');
      const knowledgeTestContainer = document.getElementById('knowledgeTestContainer');

      if (hasKnowledgeTest) {
        const testUrl = getKnowledgeTestUrl(berufId);
        knowledgeTestLink.href = testUrl;
        knowledgeTestLink.classList.remove('disabled');
        knowledgeTestLink.title = `Teste dein Wissen über ${beruf.title}`;
        knowledgeTestContainer.style.display = 'flex';

        knowledgeTestLink.addEventListener('click', resetInactivityTimer);
      } else {
        knowledgeTestContainer.style.display = 'none';
      }

      // Animationen für die Detailsektionen
      const detailSections = document.querySelectorAll('.detail-section');
      detailSections.forEach((section, index) => {
        section.style.animationDelay = `${0.3 + (index * 0.1)}s`;
      });

      // Detailseite anzeigen und Animation starten
      detailPage.style.display = 'flex';
      document.body.style.overflow = 'hidden';

      detailPage.style.animation = 'none';
      setTimeout(() => {
        detailPage.style.animation = 'slideIn 0.5s ease forwards';
      }, 10);

      // Galerie initialisieren
      setTimeout(() => {
        if (document.querySelector('.gallery-wrapper')) {
          const gallery = initializeGallery();
          window.currentGallery = gallery;
        }
      }, 500);
    }

    // Detailseite schließen
    function closeDetailPage() {
      // Benutzerinteraktion - Timer zurücksetzen
      resetInactivityTimer();
      const detailPage = document.getElementById('detailPage');
      detailPage.style.animation = 'slideOut 0.5s ease forwards';

      setTimeout(() => {
        detailPage.style.display = 'none';
        document.body.style.overflow = 'auto';
      }, 500);
    }

    // App initialisieren
    async function initializeApp() {
      const data = await fetchCmsData();

      if (data) {
        contentCache = data;

        initializeFilters(data.categories);
        createCards(data.berufe);
      }
    }

    // Touch-Events einrichten
    function setupTouchEvents() {
      document.addEventListener('click', function (event) {
        if (event.target.closest('#backButton')) {
          closeDetailPage();
        }
      });

      document.addEventListener('keydown', function (e) {
        // Benutzerinteraktion - Timer zurücksetzen
        resetInactivityTimer();
        if (e.key === 'Escape') {
          closeDetailPage();
        }
      });
    }

    // Bildschirmorientierung behandeln
    function setupOrientationHandling() {
      window.addEventListener('orientationchange', function () {
        // Benutzerinteraktion - Timer zurücksetzen
        resetInactivityTimer();
        setTimeout(() => {
          const activeCategory = document.querySelector('.filter-btn.active').dataset.category;
          filterCards(activeCategory);
        }, 100);
      });

      window.addEventListener('resize', function () {
        // Benutzerinteraktion - Timer zurücksetzen
        resetInactivityTimer();
        const isLandscape = window.innerWidth > window.innerHeight;
        document.body.classList.toggle('landscape', isLandscape);
        document.body.classList.toggle('portrait', !isLandscape);
      });

      const isLandscape = window.innerWidth > window.innerHeight;
      document.body.classList.toggle('landscape', isLandscape);
      document.body.classList.toggle('portrait', !isLandscape);
    }

    // Automatische Aktualisierung einrichten
    function setupAutoRefresh() {
      if (cmsConfig.refreshInterval > 0) {
        setInterval(async function () {
          const data = await fetchCmsData();
          if (data) {
            contentCache = data;

            if (document.getElementById('detailPage').style.display !== 'flex') {
              const activeCategory = document.querySelector('.filter-btn.active').dataset.category;
              initializeFilters(data.categories);
              createCards(data.berufe);
              filterCards(activeCategory);
            }
          }
        }, cmsConfig.refreshInterval);
      }
    }

    // Inaktivitäts-Timer-Funktionen
    let inactivityTimeout;
    let warningTimeout;
    let countdownInterval;
    const inactivityTime = 2 * 60 * 1000; // 2 Minuten
    const warningTime = 10 * 1000; // 10 Sekunden Warnung
    let remainingSeconds = 10;

    // Countdown aktualisieren
    function updateCountdown() {
      const countdownElement = document.getElementById('countdown');
      countdownElement.textContent = remainingSeconds;

      if (remainingSeconds <= 10) {
        countdownElement.style.color = '#ff0000';
        countdownElement.style.fontSize = '2.2rem';
      }

      remainingSeconds--;

      if (remainingSeconds < 0) {
        clearInterval(countdownInterval);
      }
    }

    // Warnmeldung anzeigen
    function showInactivityWarning() {
      document.getElementById('inactivityWarning').style.display = 'flex';

      remainingSeconds = Math.floor(warningTime / 1000);
      updateCountdown();

      countdownInterval = setInterval(updateCountdown, 1000);
    }

    // Warnmeldung ausblenden
    function hideInactivityWarning() {
      document.getElementById('inactivityWarning').style.display = 'none';
      clearInterval(countdownInterval);
    }

    // Timer zurücksetzen
    function resetInactivityTimer() {
      clearTimeout(inactivityTimeout);
      clearTimeout(warningTimeout);
      clearInterval(countdownInterval);

      hideInactivityWarning();

      warningTimeout = setTimeout(() => {
        showInactivityWarning();
      }, inactivityTime - warningTime);

      inactivityTimeout = setTimeout(() => {
        window.location.href = 'landing.html';
      }, inactivityTime);
    }

    // Inaktivitätserkennung einrichten
    function setupInactivityDetection() {
      const events = [
        'mousedown', 'mousemove', 'keypress',
        'scroll', 'touchstart', 'click', 'keydown'
      ];

      events.forEach(eventName => {
        document.addEventListener(eventName, resetInactivityTimer, true);
      });

      resetInactivityTimer();
    }

    // Prüfen, ob ein Wissenstest existiert
    function checkIfKnowledgeTestExists(berufId) {
      const beruf = findBerufById(berufId);

      // Wenn im CMS definiert ist, dass ein Test verfügbar ist
      if (beruf && beruf.hasKnowledgeTest) {
        return true;
      }

      // Fallback zur Liste von bekannten Tests
      const availableTests = [
        'chemielaborant',
        'fachkraft-metalltechnik',
        'fachinformatiker-systemintegration',
        'elektroniker-automatisierung'
      ];

      return availableTests.includes(berufId);
    }

    // URL für den Wissenstest abrufen
    function getKnowledgeTestUrl(berufId) {
      const beruf = findBerufById(berufId);

      // Wenn im CMS eine spezifische URL definiert ist
      if (beruf && beruf.knowledgeTestUrl) {
        return beruf.knowledgeTestUrl;
      }

      // Fallback auf lokale Tests
      const testPaths = {
        'chemielaborant': 'tests/chemielaborant.html',
        'fachkraft-metalltechnik': 'tests/metalltechnik.html',
        'fachinformatiker-systemintegration': 'tests/blank.html',
        'elektroniker-automatisierung': 'tests/eat.html'
      };

      return testPaths[berufId] || '#';
    }

    // Erweiterte Funktion für das Wissenstest-Handling
    function getKnowledgeTestUrl(berufId) {
      const beruf = findBerufById(berufId);

      // Wenn im CMS eine spezifische URL definiert ist
      if (beruf && beruf.knowledgeTestUrl) {
        return beruf.knowledgeTestUrl;
      }

      // Fallback auf lokale Tests
      const testPaths = {
        'chemielaborant': 'tests/chemielaborant.html',
        'fachkraft-metalltechnik': 'tests/metalltechnik.html',
        'fachinformatiker-systemintegration': 'tests/blank.html',
        'elektroniker-automatisierung': 'tests/eat.html'
      };

      // Prüfen ob der Test in den CMS-Daten gespeichert ist
      if (beruf && beruf.hasKnowledgeTest) {
        // API-basierter Test
        return `#quiz-${berufId}`; // Verwende einen Hash-basierten Bezeichner
      }

      return testPaths[berufId] || '#';
    }

function setupKnowledgeTestButton() {
  // QuizModalManager initialisieren
  QuizModalManager.initialize();
  
  const knowledgeTestLink = document.getElementById('testKnowledgeLink');
  if (!knowledgeTestLink) return;
  
  // Alte Event-Listener entfernen (falls vorhanden)
  const newKnowledgeTestLink = knowledgeTestLink.cloneNode(true);
  knowledgeTestLink.parentNode.replaceChild(newKnowledgeTestLink, knowledgeTestLink);
  
  // Neuen Event-Listener hinzufügen
  newKnowledgeTestLink.addEventListener('click', function(e) {
    e.preventDefault();
    resetInactivityTimer(); // Inaktivitäts-Timer zurücksetzen
    
    // Beruf-ID aus dem Detailseitenkontext extrahieren
    const berufId = document.getElementById('detailTitle').dataset.berufId;
    if (!berufId) {
      console.error('Keine Beruf-ID gefunden');
      return;
    }
    
    // QuizModalManager verwenden
    QuizModalManager.openQuizModal(berufId);
  });
}

    function loadGalleryImages(berufId) {
      const galleryWrapper = document.querySelector('.gallery-wrapper');
      galleryWrapper.innerHTML = '';

      const beruf = findBerufById(berufId);

      // Überprüfen, ob wir gültige Berufsdaten haben
      if (!beruf) {
        console.error(`Beruf mit ID ${berufId} nicht gefunden`);
        loadDefaultGalleryImages(galleryWrapper);
        return;
      }

      console.log('Lade Galerie-Bilder für:', berufId, beruf);

      // CMS-Bilder verwenden, wenn vorhanden
      if (beruf.gallery_images && beruf.gallery_images.length > 0) {
        console.log('Gefundene Galerie-Bilder:', beruf.gallery_images.length);

        // Sortierte Bilder zur besseren Übersicht
        const sortedImages = [...beruf.gallery_images].sort((a, b) => {
          // Nach ID sortieren, falls verfügbar
          if (a.id && b.id) return a.id - b.id;
          return 0;
        });

        // Erstelle die Galerie-Slides
        sortedImages.forEach((image) => {
          createGallerySlide(galleryWrapper, image);
        });
      } else {
        console.warn('Keine Galerie-Bilder für Beruf gefunden:', berufId);
        loadDefaultGalleryImages(galleryWrapper);
      }

      // Navigationspunkte aktualisieren
      const totalSlides = galleryWrapper.children.length;
      updateGalleryDots(totalSlides);
    }

    // Hilfsfunktion zum Erstellen eines Gallery-Slides
    function createGallerySlide(galleryWrapper, image) {
      const slide = document.createElement('div');
      slide.className = 'gallery-slide';

      const img = document.createElement('img');

      // Vollständige URL setzen mit Fehlerbehandlung
      if (image.url) {
        // URL bereinigen und sicherstellen, dass sie korrekt ist
        img.src = image.url.startsWith('http') ? image.url :
          image.url.startsWith('/') ? image.url : '/' + image.url;
      } else if (image.src) {
        img.src = image.src;
      } else {
        console.warn('Bild ohne URL oder src:', image);
        img.src = 'img/placeholder.jpg';
      }

      img.alt = image.alt_text || image.alt || 'Ausbildung bei Volkswagen';
      img.className = 'gallery-image';

      // Fehlerbehandlung für Bilder
      img.onerror = function () {
        console.warn(`Bild konnte nicht geladen werden: ${img.src}`);
        this.src = 'img/placeholder.jpg';
        this.onerror = null; // Verhindern von Endlosschleifen
      };

      slide.appendChild(img);
      galleryWrapper.appendChild(slide);
    }

    // Standardbilder laden, wenn keine vom CMS verfügbar sind
    function loadDefaultGalleryImages(galleryWrapper) {
      console.log('Lade Standardbilder für Galerie');
      const defaultImages = [
        {
          src: "img/gallery/default1.png",
          alt: "Ausbildung bei Volkswagen"
        },
        {
          src: "img/gallery/default2.png",
          alt: "Praktische Übungen"
        },
        {
          src: "img/gallery/default3.png",
          alt: "Team-Arbeit"
        },
        {
          src: "img/gallery/default4.jpg",
          alt: "Moderner Arbeitsplatz"
        }
      ];

      defaultImages.forEach(image => {
        createGallerySlide(galleryWrapper, image);
      });
    }

    // Navigationspunkte für die Galerie aktualisieren
    function updateGalleryDots(imageCount) {
      const dotsContainer = document.querySelector('.gallery-dots');
      dotsContainer.innerHTML = '';

      for (let i = 0; i < imageCount; i++) {
        const dot = document.createElement('span');
        dot.className = i === 0 ? 'gallery-dot active' : 'gallery-dot';
        dot.setAttribute('data-index', i);

        dot.addEventListener('click', (e) => {
          e.stopPropagation();
          const index = parseInt(dot.getAttribute('data-index'));
          if (window.galleryNavigation) {
            window.galleryNavigation.goToSlide(index);
          }
        });

        dotsContainer.appendChild(dot);
      }
    }

    // Galerie initialisieren
    function initializeGallery() {
      const galleryWrapper = document.querySelector('.gallery-wrapper');
      const prevButton = document.querySelector('.prev-button');
      const nextButton = document.querySelector('.next-button');
      const fullscreenOverlay = document.querySelector('.fullscreen-overlay');
      const fullscreenImage = document.querySelector('.fullscreen-image');
      const closeFullscreen = document.querySelector('.close-fullscreen');

      const slides = document.querySelectorAll('.gallery-slide');
      const totalSlides = slides.length;

      let currentIndex = 0;
      let startX = 0;
      let currentX = 0;
      let isDragging = false;
      let autoplayInterval = null;

      // Galerie aktualisieren
      function updateGallery() {
        galleryWrapper.style.transform = `translateX(-${currentIndex * 100}%)`;

        const currentDots = document.querySelectorAll('.gallery-dot');
        currentDots.forEach((dot, index) => {
          if (index === currentIndex) {
            dot.classList.add('active');
          } else {
            dot.classList.remove('active');
          }
        });
      }

      // Navigation
      function goToSlide(index) {
        currentIndex = index;
        updateGallery();
        resetAutoplay();
      }

      prevButton.addEventListener('click', (e) => {
        e.stopPropagation();
        currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
        updateGallery();
        resetAutoplay();
      });

      nextButton.addEventListener('click', (e) => {
        e.stopPropagation();
        currentIndex = (currentIndex + 1) % totalSlides;
        updateGallery();
        resetAutoplay();
      });

      // Touch-Events
      galleryWrapper.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        isDragging = true;
        galleryWrapper.style.transition = 'none';
      });

      galleryWrapper.addEventListener('touchmove', (e) => {
        if (!isDragging) return;

        currentX = e.touches[0].clientX;
        const diffX = currentX - startX;

        if ((currentIndex === 0 && diffX > 0) || (currentIndex === totalSlides - 1 && diffX < 0)) {
          galleryWrapper.style.transform = `translateX(calc(-${currentIndex * 100}% + ${diffX / 3}px))`;
        } else {
          galleryWrapper.style.transform = `translateX(calc(-${currentIndex * 100}% + ${diffX}px))`;
        }
      });

      galleryWrapper.addEventListener('touchend', (e) => {
        if (!isDragging) return;

        isDragging = false;
        galleryWrapper.style.transition = 'transform 0.3s ease-in-out';

        const diffX = currentX - startX;
        const threshold = galleryWrapper.offsetWidth * 0.2;

        if (Math.abs(diffX) > threshold) {
          if (diffX > 0 && currentIndex > 0) {
            currentIndex--;
          } else if (diffX < 0 && currentIndex < totalSlides - 1) {
            currentIndex++;
          }
        }

        updateGallery();
        resetAutoplay();
      });

      // Vergrößerungsfunktion
      function setupVergroesserung() {
        const currentSlides = document.querySelectorAll('.gallery-slide');

        currentSlides.forEach((slide) => {
          slide.addEventListener('click', () => {
            const img = slide.querySelector('img');
            fullscreenImage.src = img.src;
            fullscreenImage.alt = img.alt;
            fullscreenOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            clearInterval(autoplayInterval);
          });
        });
      }

      closeFullscreen.addEventListener('click', () => {
        fullscreenOverlay.classList.remove('active');
        document.body.style.overflow = '';
        startAutoplay();
      });

      fullscreenOverlay.addEventListener('click', (e) => {
        if (e.target === fullscreenOverlay) {
          fullscreenOverlay.classList.remove('active');
          document.body.style.overflow = '';
          startAutoplay();
        }
      });

      // Autoplay
      function startAutoplay() {
        autoplayInterval = setInterval(() => {
          currentIndex = (currentIndex + 1) % totalSlides;
          updateGallery();
        }, 5000);
      }

      function resetAutoplay() {
        if (autoplayInterval) {
          clearInterval(autoplayInterval);
        }
        startAutoplay();
      }

      setupVergroesserung();
      startAutoplay();
      updateGallery();

      // Navigation für externe Nutzung
      window.galleryNavigation = {
        goToSlide: goToSlide
      };

      return {
        reinitialize: () => {
          setupVergroesserung();
          updateGallery();
        }
      };
    }

    // Service Worker für Offline-Funktionalität registrieren
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js', { scope: '/' })
          .then(registration => {
            console.log('Service Worker erfolgreich registriert:', registration.scope);

            // Nach dem Speichern eines neuen Berufs die Synchronisierung auslösen
            document.addEventListener('cms-data-updated', () => {
              if (registration.sync) {
                registration.sync.register('sync-cms-data')
                  .then(() => console.log('Hintergrund-Sync für CMS-Daten registriert'))
                  .catch(err => console.error('Fehler bei der Sync-Registrierung:', err));
              }
            });
          })
          .catch(error => {
            console.error('Service Worker Registrierung fehlgeschlagen:', error);
          });
      });
    }

    // App starten, wenn DOM geladen ist
    document.addEventListener('DOMContentLoaded', () => {
      initializeApp();
      setupTouchEvents();
      setupOrientationHandling();
      setupAutoRefresh();
      setupInactivityDetection();

      // Diese Funktion nach dem Öffnen der Detailseite aufrufen
      function enhanceOpenDetailPage() {
        const originalOpenDetailPage = window.openDetailPage;

        window.openDetailPage = function (berufId) {
          // Original-Funktionsaufruf
          originalOpenDetailPage(berufId);

          // Erweiterte Funktionalität
          setupKnowledgeTestButton();
        };
      }

      // Überschreibe die originale openDetailPage-Funktion
      enhanceOpenDetailPage();

    });

    const QuizModalManager = {
  activeModal: null,
  isModalOpen: false,
  isInitialized: false,
  
  // Initialisiere den Manager nur einmal
  initialize: function() {
    if (this.isInitialized) return;
    this.isInitialized = true;
    
    // Event-Listener für Escape-Taste
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && this.isModalOpen) {
        this.closeQuizModal();
      }
    });
  },
  
  // Quiz-Modal öffnen und sicherstellen, dass nur eines gleichzeitig existiert
  openQuizModal: function(berufId) {
    // Wenn bereits ein Modal offen ist, dieses zuerst schließen
    if (this.isModalOpen) {
      this.closeQuizModal();
      
      // Kurze Verzögerung, um sicherzustellen, dass das vorherige Modal vollständig geschlossen ist
      setTimeout(() => this.proceedWithOpeningModal(berufId), 300);
      return;
    }
    
    this.proceedWithOpeningModal(berufId);
  },
  
  proceedWithOpeningModal: function(berufId) {
    // Benutzerinteraktion - Timer zurücksetzen
    resetInactivityTimer();
    this.isModalOpen = true;
    
    // API-basierten Test laden
    fetch(`/api/quiz/${berufId}`)
      .then(response => {
        if (response.ok) {
          return response.json().then(quizData => {
            this.createQuizModal(quizData, berufId);
          });
        } else {
          console.error('Quiz nicht verfügbar:', response.status);
          this.showErrorModal('Quiz nicht verfügbar', 'Dieser Wissenstest ist zurzeit nicht verfügbar.');
        }
      })
      .catch(error => {
        console.error('Fehler beim Laden des Wissenstests:', error);
        this.showErrorModal('Fehler beim Laden', 'Der Wissenstest konnte nicht geladen werden. Bitte versuche es später erneut.');
      });
  },
  
  // Fehlermeldung anzeigen
  showErrorModal: function(title, message) {
    // Stellen sicher, dass wir kein Modal doppelt erstellen
    if (document.getElementById('quiz-overlay')) {
      return;
    }
    
    // Overlay-Element erstellen
    const overlayElement = document.createElement('div');
    overlayElement.id = 'quiz-overlay';
    overlayElement.className = 'modal-overlay active';
    
    // Modal-Inhalt mit einzigartiger ID erstellen
    const modalId = `quiz-modal-${Date.now()}`;
    overlayElement.innerHTML = `
      <div class="modal quiz-modal" id="${modalId}">
        <div class="modal-header">
          <h3 class="modal-title">${title}</h3>
          <button class="modal-close" id="closeQuizBtn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="error-message" style="text-align: center; padding: 20px;">
            <p>${message}</p>
            <button class="btn btn-primary mt-4" id="closeErrorBtn">Schließen</button>
          </div>
        </div>
      </div>
    `;
    
    // Modal immer direkt zum body hinzufügen, damit es über alles gelegt wird
    document.body.appendChild(overlayElement);
    
    this.activeModal = document.getElementById(modalId);
    
    // Schließen-Button Event Listener
    overlayElement.querySelector('#closeQuizBtn').addEventListener('click', () => this.closeQuizModal());
    overlayElement.querySelector('#closeErrorBtn').addEventListener('click', () => this.closeQuizModal());
    
    // Overlay-Klick zum Schließen
    overlayElement.addEventListener('click', (e) => {
      if (e.target === overlayElement) {
        this.closeQuizModal();
      }
    });
  },
  
  // Quiz-Modal erstellen und anzeigen - mit verbessertem Design
  createQuizModal: function(quizData, berufId) {
    // Stellen sicher, dass wir kein Modal doppelt erstellen
    if (document.getElementById('quiz-overlay')) {
      return;
    }
    
    const beruf = findBerufById(berufId);
    const title = beruf ? `Wissenstest: ${beruf.title}` : quizData.title || 'Wissenstest';
    
    // Overlay-Element erstellen
    const overlayElement = document.createElement('div');
    overlayElement.id = 'quiz-overlay';
    overlayElement.className = 'modal-overlay active';
    
    // Modal-Inhalt mit einzigartiger ID erstellen
    const modalId = `quiz-modal-${Date.now()}`;
    overlayElement.innerHTML = `
      <div class="modal quiz-modal" id="${modalId}">
        <div class="modal-header">
          <h3 class="modal-title">${title}</h3>
          <button class="modal-close" id="closeQuizBtn">&times;</button>
        </div>
        <div class="modal-body" id="quiz-modal-body">
          <!-- Quiz-Inhalt wird hier dynamisch eingefügt -->
        </div>
      </div>
    `;
    
    document.body.appendChild(overlayElement);
    
    this.activeModal = document.getElementById(modalId);
    
    // Schließen-Button Event Listener
    const closeBtn = overlayElement.querySelector('#closeQuizBtn');
    closeBtn.addEventListener('click', () => this.closeQuizModal());
    
    // Overlay-Klick zum Schließen
    overlayElement.addEventListener('click', (e) => {
      if (e.target === overlayElement) {
        this.closeQuizModal();
      }
    });
    
    // Quiz-Inhalt initialisieren
    this.initializeQuizContent(quizData);
  },
  
  // Quiz-Modal schließen
  closeQuizModal: function() {
    const overlay = document.getElementById('quiz-overlay');
    if (overlay) {
      // Animation zum Ausblenden
      overlay.classList.remove('active');
      
      // Nach der Animation das Element entfernen
      setTimeout(() => {
        if (overlay.parentNode) {
          overlay.parentNode.removeChild(overlay);
        }
        this.activeModal = null;
        this.isModalOpen = false;
      }, 300);
    }
  },
  
  // Quiz-Inhalt mit originalem Design initialisieren
  initializeQuizContent: function(quizData) {
    // Variablen für den Quiz-Status
    let currentQuestionIndex = 0;
    let selectedAnswers = [];
    let score = 0;
    
    const modalBody = document.getElementById('quiz-modal-body');
    
    // Erste Frage anzeigen
    showQuestion(currentQuestionIndex);
    
    // Funktion zum Anzeigen einer Frage
    function showQuestion(index) {
      const question = quizData.questions[index];
      
      modalBody.innerHTML = `
        <div class="quiz-container">
          <p>Frage ${index + 1} von ${quizData.questions.length}</p>
          <div class="quiz-question" data-question-id="${question.id}">
            <div class="question-text">${question.text}</div>
            <div class="answer-options">
              ${question.options.map((option, i) => `
                <div class="answer-option" data-answer-id="${option.id}">
                  ${option.text}
                </div>
              `).join('')}
            </div>
          </div>
          
          <div class="quiz-feedback" style="display: none; margin-top: 15px;">
            <div class="feedback-content"></div>
          </div>
          
          <button class="btn btn-primary" id="nextQuestionBtn" style="margin-top: 15px; background-color: #001e50; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">
            Antworten
          </button>
        </div>
      `;
      
      // Event-Listener für Antwortoptionen
      const answerOptions = modalBody.querySelectorAll('.answer-option');
      answerOptions.forEach(option => {
        option.addEventListener('click', () => {
          // Vorherige Auswahl entfernen
          answerOptions.forEach(opt => opt.classList.remove('selected'));
          
          // Neue Auswahl setzen
          option.classList.add('selected');
          
          // Button-Text ändern
          const nextBtn = document.getElementById('nextQuestionBtn');
          nextBtn.disabled = false;
        });
      });
      
      // Button-Text und Status
      const nextBtn = document.getElementById('nextQuestionBtn');
      nextBtn.textContent = 'Antworten';
      
      // Event-Listener für den Button
      nextBtn.addEventListener('click', handleNextButtonClick);
    }
    
    // Handler für den Next-Button
    function handleNextButtonClick() {
      const feedback = modalBody.querySelector('.quiz-feedback');
      
      if (feedback.style.display === 'none') {
        // Wenn noch keine Antwort überprüft wurde, überprüfen
        checkAnswer();
      } else {
        // Wenn bereits überprüft wurde, zur nächsten Frage oder zum Ergebnis
        if (currentQuestionIndex < quizData.questions.length - 1) {
          currentQuestionIndex++;
          showQuestion(currentQuestionIndex);
        } else {
          showResults();
        }
      }
    }
    
    // Funktion zum Überprüfen der Antwort
    function checkAnswer() {
      const questionElement = modalBody.querySelector('.quiz-question');
      const questionId = questionElement.dataset.questionId;
      const selectedOption = questionElement.querySelector('.answer-option.selected');
      
      if (!selectedOption) {
        alert('Bitte wähle eine Antwort aus.');
        return;
      }
      
      const selectedAnswerId = selectedOption.dataset.answerId;
      const question = quizData.questions[currentQuestionIndex];
      const isCorrect = selectedAnswerId == question.correctAnswerId;
      
      // Antwort speichern
      selectedAnswers.push({
        questionIndex: currentQuestionIndex,
        questionId: questionId,
        selectedAnswerId: selectedAnswerId,
        isCorrect: isCorrect
      });
      
      if (isCorrect) {
        score++;
      }
      
      // Antworten markieren
      const options = questionElement.querySelectorAll('.answer-option');
      options.forEach(option => {
        const answerId = option.dataset.answerId;
        
        if (answerId == question.correctAnswerId) {
          option.classList.add('correct');
          option.style.backgroundColor = '#d4edda';
          option.style.borderColor = '#c3e6cb';
        } else if (answerId == selectedAnswerId && !isCorrect) {
          option.classList.add('incorrect');
          option.style.backgroundColor = '#f8d7da';
          option.style.borderColor = '#f5c6cb';
        }
        
        // Antwortoptionen deaktivieren
        option.style.pointerEvents = 'none';
      });
      
      // Feedback anzeigen
      const feedback = modalBody.querySelector('.quiz-feedback');
      feedback.style.display = 'block';
      feedback.className = `quiz-feedback ${isCorrect ? 'correct' : 'incorrect'}`;
      feedback.querySelector('.feedback-content').innerHTML = `
        <p>${isCorrect ? '<strong>Richtig!</strong>' : '<strong>Leider falsch.</strong>'} ${question.explanation || ''}</p>
      `;
      
      // Button-Text ändern
      const nextBtn = document.getElementById('nextQuestionBtn');
      nextBtn.textContent = currentQuestionIndex < quizData.questions.length - 1 ? 'Nächste Frage' : 'Ergebnis anzeigen';
    }
    
    // Funktion zum Anzeigen des Ergebnisses
    function showResults() {
      const percentage = Math.round((score / quizData.questions.length) * 100);
      
      // Ergebnis-Nachricht basierend auf dem Score
      let message = '';
      if (percentage >= 80) {
        message = 'Hervorragend! Du scheinst dich sehr gut mit diesem Beruf auszukennen!';
      } else if (percentage >= 60) {
        message = 'Gut gemacht! Du hast ein solides Wissen über diesen Beruf.';
      } else if (percentage >= 40) {
        message = 'Nicht schlecht! Mit etwas mehr Information wirst du noch besser.';
      } else {
        message = 'Du kannst gerne noch mehr über diesen Beruf erfahren. Probiere den Test später noch einmal!';
      }
      
      // Ergebnis anzeigen
      modalBody.innerHTML = `
        <div class="quiz-results">
          <h3>Dein Ergebnis</h3>
          <p class="result-score">${score} von ${quizData.questions.length} Fragen richtig beantwortet.</p>
          <div class="progress-bar" style="height: 15px; background-color: #e2e8f0; border-radius: 8px; margin: 15px 0 25px 0; overflow: hidden;">
            <div class="progress-fill" style="height: 100%; background-color: #001e50; width: ${percentage}%;"></div>
          </div>
          <p class="result-message">${message}</p>
          
          <div class="result-details" style="margin-top: 25px;">
            <h4>Übersicht:</h4>
            <div class="result-items" style="margin-top: 15px;">
              ${selectedAnswers.map((answer, index) => {
                const question = quizData.questions[answer.questionIndex];
                const selectedOption = question.options.find(opt => opt.id == answer.selectedAnswerId);
                const correctOption = question.options.find(opt => opt.id == question.correctAnswerId);
                
                return `
                  <div class="result-item" style="padding: 15px; margin-bottom: 10px; border-radius: 8px; background-color: ${answer.isCorrect ? '#d4edda' : '#f8d7da'};">
                    <p><strong>Frage ${index + 1}:</strong> ${question.text}</p>
                    <p>Deine Antwort: ${selectedOption ? selectedOption.text : 'Keine Antwort'}</p>
                    ${!answer.isCorrect ? `<p>Richtige Antwort: ${correctOption ? correctOption.text : 'Unbekannt'}</p>` : ''}
                  </div>
                `;
              }).join('')}
            </div>
          </div>
          
          <div style="margin-top: 25px; display: flex; justify-content: center; gap: 15px;">
            <button id="restartQuizBtn" class="btn btn-primary" style="background-color: #001e50; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">
              Test neu starten
            </button>
            <button id="closeResultsBtn" class="btn btn-secondary" style="background-color: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer;">
              Schließen
            </button>
          </div>
        </div>
      `;
      
      // Event-Listener für die Ergebnis-Buttons
      document.getElementById('restartQuizBtn').addEventListener('click', () => {
        currentQuestionIndex = 0;
        selectedAnswers = [];
        score = 0;
        showQuestion(0);
      });
      
      document.getElementById('closeResultsBtn').addEventListener('click', () => {
        QuizModalManager.closeQuizModal();
      });
    }
  }
};

// Überarbeitete Funktion zum Einrichten des Wissenstest-Buttons
function setupKnowledgeTestButton() {
  // QuizModalManager initialisieren
  QuizModalManager.initialize();
  
  const knowledgeTestLink = document.getElementById('testKnowledgeLink');
  if (!knowledgeTestLink) return;
  
  // Alte Event-Listener entfernen (falls vorhanden)
  const newKnowledgeTestLink = knowledgeTestLink.cloneNode(true);
  knowledgeTestLink.parentNode.replaceChild(newKnowledgeTestLink, knowledgeTestLink);
  
  // Neuen Event-Listener hinzufügen
  newKnowledgeTestLink.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation(); // Verhindert Bubbling des Events
    resetInactivityTimer(); // Inaktivitäts-Timer zurücksetzen
    
    // Beruf-ID aus dem Detailseitenkontext extrahieren
    const berufId = document.getElementById('detailTitle').dataset.berufId;
    if (!berufId) {
      console.error('Keine Beruf-ID gefunden');
      return;
    }
    
    // QuizModalManager verwenden
    QuizModalManager.openQuizModal(berufId);
  });
}

  </script>
  <script src="translation.js"></script>
</body>
</html>
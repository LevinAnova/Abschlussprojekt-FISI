<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VW Ausbildung - Admin</title>
    <link rel="stylesheet" href="css/admin-styles.css">
    <script src="js/cms.js" defer></script>
    <!-- Inline-CSS für das Modal-Problem hinzufügen -->
<style>
    /* Modal-Styling für Scrollbarkeit */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        overflow-y: auto;
        padding: 20px;
    }
    
    .modal-overlay.active {
        display: flex;
    }
    
    .modal {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        width: 100%;
        max-width: 800px;
        position: relative;
        max-height: calc(100vh - 40px); /* 40px als Padding */
        display: flex;
        flex-direction: column;
        margin: auto;
    }
    
    .modal-header {
        padding: 15px 20px;
        border-bottom: 1px solid #e5e5e5;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
    }
    
    .modal-body {
        padding: 20px;
        overflow-y: auto; /* Scrollbar für Inhalt */
        max-height: calc(100vh - 180px); /* Platz für Header und Footer */
    }
    
    .modal-footer {
        padding: 15px 20px;
        border-top: 1px solid #e5e5e5;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        flex-shrink: 0;
    }

    /* Verbesserte Mobile-Ansicht */
    @media (max-height: 768px) {
        .modal {
            height: calc(100vh - 40px);
        }
        
        .modal-body {
            max-height: none;
            flex-grow: 1;
        }
    }
</style>
</head>
<body>
    <header>
        <div class="header-container container">
            <img src="img/vwlogo.png" alt="Volkswagen Logo" class="logo">
            <h1 class="header-title">Ausbildungsberufe - Administration</h1>
        </div>
    </header>

    <main class="container">
        <!-- Navigation Tabs -->
        <ul class="tabs" id="adminTabs">
            <li class="tab-item active" data-tab="categories">Kategorien</li>
            <li class="tab-item" data-tab="professions">Ausbildungsberufe</li>
        </ul>

        <!-- Kategorien-Verwaltung -->
        <section id="categoriesSection" class="content-section active">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Kategorien verwalten</h2>
                    <button id="addCategoryBtn" class="btn btn-primary btn-sm">Neue Kategorie</button>
                </div>
                <div class="card-body">
                    <div id="categoryAlert" class="alert" style="display: none;"></div>
                    <table class="table" id="categoriesTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="categoriesList">
                            <!-- Kategorien werden hier eingefügt -->
                            <tr>
                                <td colspan="3">Kategorien werden geladen...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Berufe-Verwaltung -->
        <section id="professionsSection" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Ausbildungsberufe verwalten</h2>
                    <button id="addProfessionBtn" class="btn btn-primary btn-sm">Neuer Beruf</button>
                </div>
                <div class="card-body">
                    <div id="professionAlert" class="alert" style="display: none;"></div>
                    <table class="table" id="professionsTable">
                        <thead>
                            <tr>
                                <th>Titel</th>
                                <th>Kategorie</th>
                                <th>Ausbildungsdauer</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody id="professionsList">
                            <!-- Berufe werden hier eingefügt -->
                            <tr>
                                <td colspan="4">Berufe werden geladen...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Modals -->
        <!-- Kategorie Modal -->
        <div class="modal-overlay" id="categoryModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title" id="categoryModalTitle">Kategorie hinzufügen</h3>
                    <button class="modal-close" id="closeCategoryModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <div class="form-group">
                            <label for="categoryId" class="form-label">ID (Kurzname/Slug)</label>
                            <input type="text" id="categoryId" class="form-control" required>
                            <small>Nur Kleinbuchstaben, Zahlen und Bindestriche, z.B. "it-elektronik"</small>
                        </div>
                        <div class="form-group">
                            <label for="categoryName" class="form-label">Name</label>
                            <input type="text" id="categoryName" class="form-control" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelCategoryBtn">Abbrechen</button>
                    <button class="btn btn-primary" id="saveCategoryBtn">Speichern</button>
                </div>
            </div>
        </div>

        <!-- Beruf Modal -->
        <div class="modal-overlay" id="professionModal">
            <div class="modal" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 class="modal-title" id="professionModalTitle">Ausbildungsberuf hinzufügen</h3>
                    <button class="modal-close" id="closeProfessionModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="professionForm">
                        <div class="form-group">
                            <label for="professionId" class="form-label">ID (Kurzname/Slug)</label>
                            <input type="text" id="professionId" class="form-control" required>
                            <small>Nur Kleinbuchstaben, Zahlen und Bindestriche, z.B. "fachinformatiker-si"</small>
                        </div>
                        <div class="form-group">
                            <label for="professionTitle" class="form-label">Titel</label>
                            <input type="text" id="professionTitle" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="professionCategory" class="form-label">Kategorie</label>
                            <select id="professionCategory" class="form-control" required>
                                <!-- Kategorien werden hier eingefügt -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="professionDuration" class="form-label">Ausbildungsdauer</label>
                            <input type="text" id="professionDuration" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="professionDescription" class="form-label">Beschreibung</label>
                            <textarea id="professionDescription" class="form-control" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Anforderungen</label>
                            <div class="list-manager" id="requirementsManager">
                                <div id="requirementsList">
                                    <!-- Anforderungen werden hier eingefügt -->
                                </div>
                                <div class="add-item-form">
                                    <input type="text" class="form-control" id="newRequirement" placeholder="Neue Anforderung hinzufügen">
                                    <button type="button" class="btn btn-secondary" id="addRequirementBtn">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Karrieremöglichkeiten</label>
                            <div class="list-manager" id="careerOptionsManager">
                                <div id="careerOptionsList">
                                    <!-- Karrieremöglichkeiten werden hier eingefügt -->
                                </div>
                                <div class="add-item-form">
                                    <input type="text" class="form-control" id="newCareerOption" placeholder="Neue Karrieremöglichkeit hinzufügen">
                                    <button type="button" class="btn btn-secondary" id="addCareerOptionBtn">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Standorte</label>
                            <div class="list-manager" id="locationsManager">
                                <div id="locationsList">
                                    <!-- Standorte werden hier eingefügt -->
                                </div>
                                <div class="add-item-form">
                                    <input type="text" class="form-control" id="newLocation" placeholder="Neuen Standort hinzufügen">
                                    <button type="button" class="btn btn-secondary" id="addLocationBtn">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-check-label">
                                <input type="checkbox" id="hasKnowledgeTest"> Hat Wissenstest
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" id="cancelProfessionBtn">Abbrechen</button>
                    <button class="btn btn-primary" id="saveProfessionBtn">Speichern</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variablen für den aktuellen State
            let categories = [];
            let professions = [];
            let currentMode = 'add'; // 'add' oder 'edit'
            let currentCategoryId = null;
            let currentProfessionId = null;
            let requirements = [];
            let careerOptions = [];
            let locations = [];

            // DOM-Elemente
            const adminTabs = document.getElementById('adminTabs');
            const categoriesSection = document.getElementById('categoriesSection');
            const professionsSection = document.getElementById('professionsSection');
            const categoriesList = document.getElementById('categoriesList');
            const professionsList = document.getElementById('professionsList');
            const professionCategory = document.getElementById('professionCategory');
            
            // Modals
            const categoryModal = document.getElementById('categoryModal');
            const professionModal = document.getElementById('professionModal');
            
            // Forms
            const categoryForm = document.getElementById('categoryForm');
            const professionForm = document.getElementById('professionForm');
            
            // Buttons
            const addCategoryBtn = document.getElementById('addCategoryBtn');
            const addProfessionBtn = document.getElementById('addProfessionBtn');
            const saveCategoryBtn = document.getElementById('saveCategoryBtn');
            const saveProfessionBtn = document.getElementById('saveProfessionBtn');
            const cancelCategoryBtn = document.getElementById('cancelCategoryBtn');
            const cancelProfessionBtn = document.getElementById('cancelProfessionBtn');
            const closeCategoryModal = document.getElementById('closeCategoryModal');
            const closeProfessionModal = document.getElementById('closeProfessionModal');
            const addRequirementBtn = document.getElementById('addRequirementBtn');
            const addCareerOptionBtn = document.getElementById('addCareerOptionBtn');
            const addLocationBtn = document.getElementById('addLocationBtn');
            
            // List containers
            const requirementsList = document.getElementById('requirementsList');
            const careerOptionsList = document.getElementById('careerOptionsList');
            const locationsList = document.getElementById('locationsList');
            
            // Alerts
            const categoryAlert = document.getElementById('categoryAlert');
            const professionAlert = document.getElementById('professionAlert');

            // Tab-Wechsel
            adminTabs.addEventListener('click', function(e) {
                if (e.target.classList.contains('tab-item')) {
                    const activeTab = adminTabs.querySelector('.active');
                    if (activeTab) {
                        activeTab.classList.remove('active');
                    }
                    
                    e.target.classList.add('active');
                    
                    const tabName = e.target.dataset.tab;
                    document.querySelectorAll('.content-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    if (tabName === 'categories') {
                        categoriesSection.classList.add('active');
                    } else if (tabName === 'professions') {
                        professionsSection.classList.add('active');
                    }
                }
            });

            // Helfer-Funktionen für Modals
            function openModal(modal) {
                modal.classList.add('active');
            }
            
            function closeModal(modal) {
                modal.classList.remove('active');
            }
            
            // Kategorie-Modal öffnen/schließen
            addCategoryBtn.addEventListener('click', function() {
                currentMode = 'add';
                document.getElementById('categoryModalTitle').textContent = 'Kategorie hinzufügen';
                document.getElementById('categoryId').value = '';
                document.getElementById('categoryId').disabled = false;
                document.getElementById('categoryName').value = '';
                openModal(categoryModal);
            });
            
            closeCategoryModal.addEventListener('click', function() {
                closeModal(categoryModal);
            });
            
            cancelCategoryBtn.addEventListener('click', function() {
                closeModal(categoryModal);
            });
            
            // Beruf-Modal öffnen/schließen
            addProfessionBtn.addEventListener('click', function() {
                currentMode = 'add';
                document.getElementById('professionModalTitle').textContent = 'Ausbildungsberuf hinzufügen';
                document.getElementById('professionId').value = '';
                document.getElementById('professionId').disabled = false;
                document.getElementById('professionTitle').value = '';
                document.getElementById('professionDescription').value = '';
                document.getElementById('professionDuration').value = '';
                document.getElementById('hasKnowledgeTest').checked = false;
                
                // Listen leeren
                requirements = [];
                careerOptions = [];
                locations = [];
                renderRequirements();
                renderCareerOptions();
                renderLocations();
                
                // Kategorien laden
                loadCategoriesForSelect();
                
                openModal(professionModal);
            });
            
            closeProfessionModal.addEventListener('click', function() {
                closeModal(professionModal);
            });
            
            cancelProfessionBtn.addEventListener('click', function() {
                closeModal(professionModal);
            });

            // Listen-Manager
            addRequirementBtn.addEventListener('click', function() {
                const input = document.getElementById('newRequirement');
                if (input.value.trim()) {
                    requirements.push(input.value.trim());
                    renderRequirements();
                    input.value = '';
                }
            });
            
            addCareerOptionBtn.addEventListener('click', function() {
                const input = document.getElementById('newCareerOption');
                if (input.value.trim()) {
                    careerOptions.push(input.value.trim());
                    renderCareerOptions();
                    input.value = '';
                }
            });
            
            addLocationBtn.addEventListener('click', function() {
                const input = document.getElementById('newLocation');
                if (input.value.trim()) {
                    locations.push(input.value.trim());
                    renderLocations();
                    input.value = '';
                }
            });
            
            function renderRequirements() {
                requirementsList.innerHTML = '';
                requirements.forEach((item, index) => {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item';
                    listItem.innerHTML = `
                        <div class="list-item-content">${item}</div>
                        <div class="list-item-actions">
                            <button type="button" class="btn btn-danger btn-sm delete-requirement" data-index="${index}">&times;</button>
                        </div>
                    `;
                    requirementsList.appendChild(listItem);
                });
                
                // Event-Listener für Lösch-Buttons
                document.querySelectorAll('.delete-requirement').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        requirements.splice(index, 1);
                        renderRequirements();
                    });
                });
            }
            
            function renderCareerOptions() {
                careerOptionsList.innerHTML = '';
                careerOptions.forEach((item, index) => {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item';
                    listItem.innerHTML = `
                        <div class="list-item-content">${item}</div>
                        <div class="list-item-actions">
                            <button type="button" class="btn btn-danger btn-sm delete-career-option" data-index="${index}">&times;</button>
                        </div>
                    `;
                    careerOptionsList.appendChild(listItem);
                });
                
                // Event-Listener für Lösch-Buttons
                document.querySelectorAll('.delete-career-option').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        careerOptions.splice(index, 1);
                        renderCareerOptions();
                    });
                });
            }
            
            function renderLocations() {
                locationsList.innerHTML = '';
                locations.forEach((item, index) => {
                    const listItem = document.createElement('div');
                    listItem.className = 'list-item';
                    listItem.innerHTML = `
                        <div class="list-item-content">${item}</div>
                        <div class="list-item-actions">
                            <button type="button" class="btn btn-danger btn-sm delete-location" data-index="${index}">&times;</button>
                        </div>
                    `;
                    locationsList.appendChild(listItem);
                });
                
                // Event-Listener für Lösch-Buttons
                document.querySelectorAll('.delete-location').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        locations.splice(index, 1);
                        renderLocations();
                    });
                });
            }

            // CRUD-Funktionen für Kategorien
            async function loadCategories() {
                try {
                    categoriesList.innerHTML = '<tr><td colspan="3">Kategorien werden geladen...</td></tr>';
                    categories = await cmsApi.getCategories();
                    renderCategories();
                    showAlert(categoryAlert, 'Kategorien erfolgreich geladen.', 'success');
                } catch (error) {
                    console.error('Fehler beim Laden der Kategorien:', error);
                    categoriesList.innerHTML = '<tr><td colspan="3">Fehler beim Laden der Kategorien.</td></tr>';
                    showAlert(categoryAlert, 'Fehler beim Laden der Kategorien: ' + error.message, 'danger');
                }
            }
            
            function renderCategories() {
                if (categories.length === 0) {
                    categoriesList.innerHTML = '<tr><td colspan="3">Keine Kategorien gefunden.</td></tr>';
                    return;
                }
                
                categoriesList.innerHTML = '';
                categories.forEach(category => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${category.id}</td>
                        <td>${category.name}</td>
                        <td>
                            <button class="btn btn-secondary btn-sm edit-category" data-id="${category.id}">Bearbeiten</button>
                            <button class="btn btn-danger btn-sm delete-category" data-id="${category.id}">Löschen</button>
                        </td>
                    `;
                    categoriesList.appendChild(row);
                });
                
                // Event-Listener für Bearbeiten-Buttons
                document.querySelectorAll('.edit-category').forEach(button => {
                    button.addEventListener('click', function() {
                        const categoryId = this.dataset.id;
                        const category = categories.find(c => c.id === categoryId);
                        
                        if (category) {
                            currentMode = 'edit';
                            currentCategoryId = categoryId;
                            document.getElementById('categoryModalTitle').textContent = 'Kategorie bearbeiten';
                            document.getElementById('categoryId').value = category.id;
                            document.getElementById('categoryId').disabled = true; // ID kann nicht geändert werden
                            document.getElementById('categoryName').value = category.name;
                            openModal(categoryModal);
                        }
                    });
                });
                
                // Event-Listener für Lösch-Buttons
                document.querySelectorAll('.delete-category').forEach(button => {
                    button.addEventListener('click', function() {
                        const categoryId = this.dataset.id;
                        if (confirm(`Möchten Sie die Kategorie "${categoryId}" wirklich löschen?`)) {
                            deleteCategory(categoryId);
                        }
                    });
                });
            }
            
            async function saveCategory() {
                const categoryId = document.getElementById('categoryId').value.trim();
                const categoryName = document.getElementById('categoryName').value.trim();
                
                if (!categoryId || !categoryName) {
                    showAlert(categoryAlert, 'ID und Name sind erforderlich.', 'danger');
                    return;
                }
                
                try {
                    const category = {
                        id: categoryId,
                        name: categoryName,
                        isNew: currentMode === 'add'
                    };
                    
                    await cmsApi.saveCategory(category);
                    closeModal(categoryModal);
                    loadCategories();
                    showAlert(categoryAlert, `Kategorie erfolgreich ${currentMode === 'add' ? 'erstellt' : 'aktualisiert'}.`, 'success');
                } catch (error) {
                    console.error('Fehler beim Speichern der Kategorie:', error);
                    showAlert(categoryAlert, 'Fehler beim Speichern der Kategorie: ' + error.message, 'danger');
                }
            }
            
            async function deleteCategory(categoryId) {
                try {
                    await cmsApi.deleteCategory(categoryId);
                    loadCategories();
                    showAlert(categoryAlert, 'Kategorie erfolgreich gelöscht.', 'success');
                } catch (error) {
                    console.error('Fehler beim Löschen der Kategorie:', error);
                    showAlert(categoryAlert, 'Fehler beim Löschen der Kategorie: ' + error.message, 'danger');
                }
            }
            
            // CRUD-Funktionen für Berufe
            async function loadProfessions() {
                try {
                    professionsList.innerHTML = '<tr><td colspan="4">Berufe werden geladen...</td></tr>';
                    professions = await cmsApi.getProfessions();
                    renderProfessions();
                    showAlert(professionAlert, 'Berufe erfolgreich geladen.', 'success');
                } catch (error) {
                    console.error('Fehler beim Laden der Berufe:', error);
                    professionsList.innerHTML = '<tr><td colspan="4">Fehler beim Laden der Berufe.</td></tr>';
                    showAlert(professionAlert, 'Fehler beim Laden der Berufe: ' + error.message, 'danger');
                }
            }
            
            function renderProfessions() {
                if (professions.length === 0) {
                    professionsList.innerHTML = '<tr><td colspan="4">Keine Berufe gefunden.</td></tr>';
                    return;
                }
                
                professionsList.innerHTML = '';
                professions.forEach(profession => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${profession.title}</td>
                        <td>${profession.category_name || profession.category_id}</td>
                        <td>${profession.duration}</td>
                        <td>
                            <button class="btn btn-secondary btn-sm edit-profession" data-id="${profession.id}">Bearbeiten</button>
                            <button class="btn btn-danger btn-sm delete-profession" data-id="${profession.id}">Löschen</button>
                        </td>
                    `;
                    professionsList.appendChild(row);
                });
                
                // Event-Listener für Bearbeiten-Buttons
                document.querySelectorAll('.edit-profession').forEach(button => {
                    button.addEventListener('click', function() {
                        const professionId = this.dataset.id;
                        editProfession(professionId);
                    });
                });
                
                // Event-Listener für Lösch-Buttons
                document.querySelectorAll('.delete-profession').forEach(button => {
                    button.addEventListener('click', function() {
                        const professionId = this.dataset.id;
                        const profession = professions.find(p => p.id === professionId);
                        if (confirm(`Möchten Sie den Beruf "${profession.title}" wirklich löschen?`)) {
                            deleteProfession(professionId);
                        }
                    });
                });
            }
            
            async function loadCategoriesForSelect() {
                try {
                    if (categories.length === 0) {
                        categories = await cmsApi.getCategories();
                    }
                    
                    professionCategory.innerHTML = '';
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        professionCategory.appendChild(option);
                    });
                } catch (error) {
                    console.error('Fehler beim Laden der Kategorien für das Dropdown:', error);
                    showAlert(professionAlert, 'Fehler beim Laden der Kategorien: ' + error.message, 'danger');
                }
            }
            
            async function editProfession(professionId) {
                try {
                    const profession = await cmsApi.getProfession(professionId);
                    
                    currentMode = 'edit';
                    currentProfessionId = professionId;
                    document.getElementById('professionModalTitle').textContent = 'Ausbildungsberuf bearbeiten';
                    document.getElementById('professionId').value = profession.id;
                    document.getElementById('professionId').disabled = true; // ID kann nicht geändert werden
                    document.getElementById('professionTitle').value = profession.title;
                    document.getElementById('professionDescription').value = profession.description;
                    document.getElementById('professionDuration').value = profession.duration;
                    document.getElementById('hasKnowledgeTest').checked = profession.has_knowledge_test;
                    
                    // Kategorien laden und Vorauswahl setzen
                    await loadCategoriesForSelect();
                    document.getElementById('professionCategory').value = profession.category_id;
                    
                    // Listen laden
                    requirements = profession.requirements || [];
                    careerOptions = profession.career_options || [];
                    locations = profession.locations || [];
                    renderRequirements();
                    renderCareerOptions();
                    renderLocations();
                    
                    openModal(professionModal);
                } catch (error) {
                    console.error('Fehler beim Laden des Berufs:', error);
                    showAlert(professionAlert, 'Fehler beim Laden des Berufs: ' + error.message, 'danger');
                }
            }
            
            async function saveProfession() {
                const professionId = document.getElementById('professionId').value.trim();
                const professionTitle = document.getElementById('professionTitle').value.trim();
                const professionDescription = document.getElementById('professionDescription').value.trim();
                const professionDuration = document.getElementById('professionDuration').value.trim();
                const categoryId = document.getElementById('professionCategory').value;
                const hasKnowledgeTest = document.getElementById('hasKnowledgeTest').checked;
                
                if (!professionId || !professionTitle || !professionDescription || !professionDuration || !categoryId) {
                    showAlert(professionAlert, 'Alle Pflichtfelder müssen ausgefüllt sein.', 'danger');
                    return;
                }
                
                try {
                    const profession = {
                        id: professionId,
                        title: professionTitle,
                        description: professionDescription,
                        duration: professionDuration,
                        category: categoryId,
                        has_knowledge_test: hasKnowledgeTest,
                        requirements: requirements,
                        career_options: careerOptions,
                        locations: locations
                    };
                    
                    await cmsApi.saveProfession(profession);
                    closeModal(professionModal);
                    loadProfessions();
                    showAlert(professionAlert, `Beruf erfolgreich ${currentMode === 'add' ? 'erstellt' : 'aktualisiert'}.`, 'success');
                } catch (error) {
                    console.error('Fehler beim Speichern des Berufs:', error);
                    showAlert(professionAlert, 'Fehler beim Speichern des Berufs: ' + error.message, 'danger');
                }
            }
            
            async function deleteProfession(professionId) {
                try {
                    await cmsApi.deleteProfession(professionId);
                    loadProfessions();
                    showAlert(professionAlert, 'Beruf erfolgreich gelöscht.', 'success');
                } catch (error) {
                    console.error('Fehler beim Löschen des Berufs:', error);
                    showAlert(professionAlert, 'Fehler beim Löschen des Berufs: ' + error.message, 'danger');
                }
            }

            // Helfer-Funktion zum Anzeigen von Alerts
            function showAlert(alertElement, message, type) {
                alertElement.innerHTML = `<div class="alert-icon">${type === 'success' ? '✓' : '⚠'}</div>${message}`;
                alertElement.className = `alert alert-${type}`;
                alertElement.style.display = 'flex';
                
                // Alert nach 5 Sekunden ausblenden
                setTimeout(() => {
                    alertElement.style.display = 'none';
                }, 5000);
            }

            // Event-Listener für Formular-Buttons
            saveCategoryBtn.addEventListener('click', saveCategory);
            saveProfessionBtn.addEventListener('click', saveProfession);

            // Initial laden
            loadCategories();
            loadProfessions();
        });
    </script>
</body>
</html>